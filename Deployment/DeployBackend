# vim: set ft=sh sw=2 ts=8 et :
deploy_backend_deps()
{
  true
}

deploy_backend_prep()
{
  mkdir -p $root/projects
  $nogroups || chgrp _sw $root/projects
  $nogroups || chmod ug+rw,o-w $root/projects

  mkproj backend
  if [ ! -f $root/projects/conf/.applied ]; then
    note "INFO: copying projects/conf area from cmsweb protected area"
    mkdir -p $root/projects/conf/certs
    rsync -cavu --no-group --delete \
      -f 'P /certs' -f 'P /wmcore/header-auth-key' -f 'P /sitedb/sitedb.ini' \
      cmsweb@lxplus.cern.ch:private/conf/ $root/projects/conf/
    touch $root/projects/conf/.applied
  fi

  setgroup -R ug+r,o-rwx _config $root/projects/conf
  setgroup go-rw _config $(find $root/projects/conf/certs -type f)
  setgroup ug+rx _config $(find $root/projects/conf -type d)
}

deploy_backend_sw()
{
  deploy_pkg -d backend -l app comp cms+pystack 1.0b-cmp2
}

deploy_backend_post()
{
  case $HOME@$host:$root in
    /home/cmsweb@vocms*:/data )
      rm -f $HOME/.pygdbinit $HOME/bin/pystack $HOME/bin/gdb
      mkdir -p $HOME/bin

      L=$(readlink $root/projects/backend/app)
      ln -s $L/bin/pystack $HOME/bin/pystack
      ln -s $L/bin/gdb $HOME/bin/gdb
      ;;
  esac
}
