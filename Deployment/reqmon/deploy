# vim: set ft=sh sw=2 ts=8 et :
deploy_reqmon_variants="default prod preprod dev offsite"

deploy_reqmon_deps()
{
  deploy wmcore-auth
  case $variant in
    offsite )
      deploy wmcore ;;
    * )
      ;;
  esac
}

deploy_reqmon_prep()
{
  case $variant in offsite ) extra=install ;; * ) extra= ;; esac
  mkproj $extra
}

deploy_reqmon_sw()
{
  case $variant in
    offsite )
      local wmcore_etc=$root/current/apps/wmcore/etc

      ://regsvc-dev01.cern.ch/reqmgr/GlobalMonitor/;
    * )
      # get manage script from wmcore
      cp $wmcore_etc/deploy/wmagent-manage $project_config/manage

      ;;
    * )
      case $variant in *prod ) secrets= ;; * ) secrets=Dev ;; esac
      deploy_pkg \
        -a dmwm-service-cert.pem:wmcore/dmwm-service-cert.pem \
        -a dmwm-service-key.pem:wmcore/dmwm-service-key.pem \
        comp cms+reqmon 0.0.8.head

      if grep -rq "replace me" $project_auth; then
        note "WARNING: replace certificates in $project_auth with real ones"
      fi
      ;;
  esac
}

deploy_reqmon_post()
{
  case $host in vocms13[89] ) disable ;; * ) enable ;; esac

  case $variant in
    offsite )
      ;;
     * )
      ;;
  esac
}

deploy_reqmon_auth()
{
  case $1 in
    */*-cert.pem )
      echo "replace me with your dmwm service certificate" ;;
    */*-key.pem )
      echo "replace me with your dmwm service key" ;;
  esac
}
