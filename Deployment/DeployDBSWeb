# vim: set ft=sh sw=2 ts=8 et :
deploy_dbsweb_deps()
{
  deploy Backend
}

deploy_dbsweb_prep()
{
  mkproj dbsweb logs
  setgroup ug+rw,o-w _dbsweb $PWD/logs
}

deploy_dbsweb_sw()
{
  deploy_pkg -d dbsweb -l app -c DBSWeb comp cms+dbs-web V06_00_47
  perl -p -i -e 's{os\.chmod}{#os.chmod}g' app/lib/python2.6/site-packages/utils/DDConfig.py
  perl -p -i -e "s{/data/projects/}{$root/projects/}g" config/DBSDD.conf config/manage
  setgroup ug+r,g-w,o-rwx _config config/DBSDD.conf
  chmod g-w,o-rwx config/DBSDD.conf

  for f in app/lib/python*/site-packages; do
    [ -f $f/DBSDD.conf ] || continue
    ln -sf $PWD/config/DBSDD.conf $f/DBSDD.conf
  done

  cd app
  (. etc/profile.d/init.sh
   cd lib/python*/site-packages
   rm -f YUI yui WEBTOOLS
   ln -s $YUI_ROOT/build YUI
   ln -s $YUI_ROOT yui
   ln -s $WEBTOOLS_ROOT/lib/python2.6/site-packages/Controllers WEBTOOLS
   mkdir -p rss
   ./scripts/genTemplates.sh)
}

deploy_dbsweb_post()
{
  cd $root/projects/dbsweb
  (crontab -l | { fgrep -v -e $PWD/ || true; };
   sysboot _dbsweb) | crontab -
}
