# vim: set ft=sh sw=2 ts=8 et :
deploy_admin_deps()
{
  deploy Backend
}

deploy_admin_prep()
{
  mkproj admin logs
  $MIGRATION rm -f logs/_*
}

deploy_admin_sw()
{
  deploy_pkg -d admin -l app -c CMSWEB comp external+rotatelogs 2.2.14-cmp
  (echo ". $root/projects/backend/app/etc/profile.d/init.sh"
   echo ". $root/projects/admin/app/etc/profile.d/init.sh") > init.sh
}

deploy_admin_post()
{
  cd $root/projects/admin
  $PWD/config/ProxyRenew $root/projects/conf/certs cmsweb_backends cms
  (crontab -l | { fgrep -v -e $PWD/ || true; }
   echo "@reboot . $PWD/init.sh && $PWD/config/ServerMonitor -r"
   echo "*/6 * * * * . $PWD/init.sh && $PWD/config/ServerMonitor -q -v"
   echo "37 */8 * * * . $PWD/init.sh && $PWD/config/ServerMonitor -q -r"
   echo "58 2 * * * $PWD/config/LogArchive $root"
   echo "3 */3 * * * $PWD/config/ProxyRenew $root/projects/conf/certs cmsweb_backends cms") |
   crontab -
}
